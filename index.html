<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TeknoFiyat — Canlı Fiyat Takip</title>
  <style>
    :root{
      --blue:#cce9ff;
      --dark:#0b0f17;
      --card:#ffffff;
      --muted:#667788;
    }
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,var(--blue),#eef8ff);color:var(--dark);}
    header{background:var(--dark);color:white;padding:20px 16px;text-align:center}
    h1{margin:0;font-size:20px}
    main{max-width:980px;margin:28px auto;padding:0 16px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:16px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(11,15,23,0.08);border-top:6px solid #0077d9}
    .title{font-weight:700;margin-bottom:8px;font-size:15px;color:var(--dark)}
    .link{display:block;color:#0077d9;text-decoration:none;margin-bottom:8px}
    .price{font-weight:800;font-size:18px;color:var(--dark)}
    .old{font-size:13px;color:var(--muted);text-decoration:line-through;margin-left:8px}
    .updated{font-size:12px;color:var(--muted);margin-top:8px}
    footer{max-width:980px;margin:30px auto 60px;text-align:center;color:var(--muted)}
  </style>
</head>
<body>
  <header><h1>TeknoFiyat — Gerçek Zamanlı Fiyat Takip</h1></header>

  <main>
    <div id="loading" style="text-align:center;margin:18px 0;color:var(--muted)">Veriler yükleniyor…</div>
    <div id="grid" class="grid"></div>
  </main>

  <footer>Fiyatlar kaynağından otomatik çekilir — güncellemeler her 6 saatte bir gerçekleşir.</footer>

  <script>
    const RAW_JSON = './data.json';

    async function load() {
      const grid = document.getElementById('grid');
      const loading = document.getElementById('loading');
      try {
        const res = await fetch(RAW_JSON + '?cachebust=' + Date.now());
        if (!res.ok) throw new Error('JSON alınamadı: ' + res.status);
        const data = await res.json();
        loading.style.display = 'none';
        grid.innerHTML = '';
        if (!Array.isArray(data) || data.length === 0) {
          grid.innerHTML = '<div style="grid-column:1/-1;text-align:center;color:var(--muted)">Henüz ürün yok veya veri alınamıyor.</div>';
          return;
        }
        data.forEach(item => {
          const el = document.createElement('div');
          el.className = 'card';
          const name = item.name || 'Bilinmeyen Ürün';
          const link = item.link || '#';
          const price = item.price || 'Fiyat yok';
          const old = item.oldPrice || null;
          const updated = item.updatedAt ? new Date(item.updatedAt).toLocaleString() : null;

          el.innerHTML = `
            <div class="title">${name}</div>
            <a class="link" href="${link}" target="_blank" rel="noopener noreferrer">${link}</a>
            <div><span class="price">${price}</span>${ old ? `<span class="old">${old}</span>` : '' }</div>
            ${ updated ? `<div class="updated">Son güncelleme: ${updated}</div>` : '' }
          `;
          grid.appendChild(el);
        });
      } catch (err) {
        loading.innerText = 'Veriler çekilemedi: ' + err.message;
        console.error(err);
      }
    }

    load();
    setInterval(load, 60 * 1000);
  </script>
</body>
</html>
